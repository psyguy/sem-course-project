---
title: "Discrimination, Trust, and Hope in Political Change in Europe 2016"
subtitle: "Structural Equation Modeling Course Project - KU Leuven"
author: "MohammadHossein Manuel Haqiqatkhah - R0607671"
date: "August 2019"
bibliography: ref.bib
output: pdf_document
---


```{r setup, include = FALSE, echo = FALSE}
list.of.packages <- c("tidyverse",
                      "plyr",
                      "qgraph",
                      "dplyr",
                      "knitr",
                      "kableExtra",
                      "psych",
                      "kutils",
                      "semPlot",
                      "lavaan")
new.packages <-
  list.of.packages[!(list.of.packages %in% installed.packages()[, "Package"])]
if (length(new.packages)) {
  install.packages(new.packages, repos='http://cran.us.r-project.org')
}
tmp <- lapply(list.of.packages, require, character.only = TRUE)

rm(list.of.packages, new.packages, tmp)

knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
# rm(list = ls())

```


```{r handy-functions}

pagebreak <- function(){
  if(knitr::is_latex_output())
    return("\\newpage")
  else
    return('<div style="page-break-before: always;" />')
}


l_o <- function(m, d = d){
  
  f <- lavaan(m,
              d,
              ordered = c("psppsgva",
                     "actrolga",
                     "psppipla",
                     "cptppola"),
              std.lv = TRUE,
              auto.var=TRUE)
  
  s <- f %>%
    parameterEstimates(add.attributes = TRUE) %>%
    filter(est != 0)
  # colnames(s)[1:3] <- c("Of", "op", "on")
  fm <- f %>% fitmeasures()

  
  o <- list(f = f,
            s = s,
            l = s %>% filter(op == "=~") %>% select(-exo),
            vcv = s %>% filter(op == "~~") %>% select(-exo),
            r = s %>% filter(op == "~") %>% select(-exo),
            inc = s %>% filter(op == "~1", est != 0) %>% select(-exo),
            thr = s %>% filter(op == "|") %>% select(-exo),
            ch = round(fm["chisq"],2),
            df = round(fm["df"],0),
            p = round(fm["df"],3),
            cfi = round(fm["cfi"],3),
            rmsea = round(fm["rmsea"],3),
            srmr = round(fm["srmr"],3),
            tli = round(fm["tli.scaled"],3)
            )
  
  
  o %>% return()
}

p <- function(f){

semPaths(f,
         title = FALSE,
         curvePivot = T,
         what = "std",
         rotation = 4,
         # edge.color = "black",
         # style = "mx",
         layout = "tree3",
         optimizeLatRes = TRUE,
         intercepts = FALSE,
         edge.label.cex = 0.001,
         exoVar=FALSE,
         sizeMan = 5,
         # centerLevels = FALSE,
         sizeLat=10,
         nCharNodes=15,
         # groups = "latents",
         # fixedStyle=1,
         # freeStyle=1,
         # filetype = "pdf", # Store to PDF
         # filename = "x", # Set the name of the file
         # mar = c(1, 1, 1, 1),
         residuals=FALSE
         )

}

```


```{r data}

# selecting items and reading data ----------------------------------------------

items <- list(
  discrimination = c("dscrrce",
                     "dscrntn",
                     "dscrrlg",
                     "dscrlng",
                     "dscretn",
                     "dscrage",
                     "dscrgnd",
                     "dscrsex",
                     "dscrdsb",
                     "dscroth"
                     ),
  
  trust_social = c("ppltrst",
                   "pplfair",
                   "pplhlp"
                   ),
  
  trust_political = c("trstprl",
                      "trstlgl",
                      "trstplc",
                      "trstplt",
                      "trstprt"
                      ),
  
  hope_political = c("psppsgva",
                     "actrolga",
                     "psppipla",
                     "cptppola"),
  
  interest_political = "polintr"
  
)

# items_ordered <- items
# items_ordered$trust_social <- NULL
# items_ordered$trust_political <- NULL
# items_ordered <- items$hope_political
# items_ordered <- items_ordered %>% unlist() %>% as.character()

## reading, selecting, and saving the abridged data to GitHub
# data.orig <- read.csv("https://raw.githubusercontent.com/psyguy/sem-course-project/master/data/ESS8e02.1_F1.csv")
# data.orig <- read.csv("data/ESS8e02.1_F1.csv")
# d <- data.orig %>% select(cntry, as.character(unlist(items)))
# d %>% write.csv("data/ess2016_selected.csv", row.names = FALSE)

data <- read.csv("https://github.com/psyguy/sem-course-project/raw/master/data/ess2016_selected.csv")


# cleaning/recoding the data ----------------------------------------------

d <- data
# removing invalid/missing data
d[d>10] <- NA
d$polintr[d$polintr>4] <- NA
d[,20:23][d[,20:23]>5] <- NA
# reverse-coding polint
d$polintr <- (d$polintr-5) %>% abs()

dscrscore <- d %>% select(contains("dscr")) %>% rowSums()

ds <- d %>% select(contains("dscr"))
dspc <- (princomp(ds,1)$scores)[,1]

d <- d %>% cbind(dscrscore, dspc) %>%  na.omit()

d <- d %>% filter(cntry == "BE")

```


# Introduction

Democracy literally means "rule by the people," and hence it heavily relies on the citizens---what is to a government which lacks *rulers*?
In democratic societies, citizens participate in their government by delegating their power to their representatives, i.e., politicians. However, not all delegates deserve trust, and not all people find other members of society---normal or powerful---trustworthy.

On the other hand, the *ruler* (i.e., the citizens) should see a positive outlook of their ruling---that it is effective and can, hopefully, make a difference.

Among the myriad of factors involved in trust in others (including politicians) and hope in the efficacy of citizens' participation in democracy, perception of discrimination might play a key role. If members of a society feel being discriminated against, they might tend to trust others (and their politicians) less, and see a less bright future in the horizon.

This study, based on the 8th round of the European Social Survey (ESS) data [-@noauthor_european_2017], investigates whether constructs of trust, hope in political change, and perception of discrimination are related to each other---and how.

# Research Hypothesis

Is there a link between the perception of discrimination and trust in others and hope in the effectiveness of participation in politics?


# Material

The original dataset included responses from 23 European countries participating in @noauthor_european_2017. The items of the ESS questionnaire relevant to the research question (i.e., trust in others and politicians; perception of discrimination; and hope for a positive outcome of participation in politics) were extracted. The items and their descriptions are shown in Table 1. The invalid responses (missing, refused to answer, and "don't know") were excluded from the dataset.

The items about discrimination were binary, including various forms of discrimination that people can experience. These items include `dscrrce`, `dscrntn`, `dscrrlg`, `dscrlng`, `dscretn`, `dscrage`, `dscrgnd`, `dscrsex`, `dscrdsb`, and `dscroth`. To summarize these items, another item (i.e., `dscrscore`) was added to the dataset which was defined as some of the responses on the indicators of discrimination. Hence, experiencing multiple forms of discrimination increases the total score on the perception of discrimination.

The items regarding trust belonged to two categories: trust in people in general (social trust, including ` ppltrst`, `pplfair`, and `pplhlp`) and trust in politicians or political institutions (political trust, including ` trstprl`, `trstlgl`, `trstplc`, `trstplt`, and `trstprt`). These items were discrete with 11 levels (0-10), hence treated as continuous. The items concerning political trust in the European Union and the United Nations were excluded, as they could be directly affected by responders' nationality and their perception of the role their country plays in (and how it is treated by) the EU and the UN.

The items about hope in politics (i.e., ` psppsgva`, `actrolga`, `psppipla`, and `cptppola`) were recorded as qualitative responses in 5-level Likert scales (e.g., *Not at all*, *A little able*, *Quite able*, *Very able*, and *Completely able*), hence treated as ordered responses. 

Since the attitudes towards politics and politicians depend on whether the responder is interested in politics or not, the item indicating interest in politics (i.e., `polint`) was also added. `polint` was on a 4-level Likert scale and reverse-coded (1 to 4, for "Very interested" to "Not at all interested"). Hence, the coding was reversed in this study.

# Modeling Strategy

Perception of discrimination seems to be a latent formative construct; the various forms of discriminations one experiences *add up* to form that experience. Hence, at a first attempt, a latent variable of `discrimination` was included as a formative factor. However, due to sparsity of the responses on discrimination items, they reduced model fit while adding to model complexity. Hence, this formative factor was excluded from further modeling and two alternatives (using all discrimination items, and the sum score of the items) were used as exogenous variables.

Since the social and political trust could be caused by distinct constructs, they were modeled by two latent variables: `SocTrst` and `PolTrst`, respectively. However, since they both share an element of "trust," these factors were allowed to correlate.

The latent variable `PolHope` was also included and the items regarding hope in efficacy of political actions loaded on it.

The interest in politics (i.e., `polint`) was used as an exogenous variable, upon which the latent variables can be regressed. Because of the non-normality of the responses, the intercept of items were included in the models (not shownin the outputs).

All latent variances were fixed to one. The SEM analysis was done using R package `lavaan` [@rosseel_lavaan_2012], and the models were visualized using package `semPlot` [@epskamp_semplot_2015].

## Model 1

```{r}
m1 <- "

# 1. latent variable definitions

  hope_political =~ NA*psppsgva + actrolga + psppipla + cptppola
  trust_social =~ NA*ppltrst + pplfair + pplhlp
  trust_political =~ NA*trstprl + trstlgl + trstplc + trstplt + trstprt

# 2. regressions

  hope_political + trust_social + trust_political ~ dscrscore + polintr

# 3. (co)variances

  hope_political ~~ 1*hope_political
  trust_social ~~ 1*trust_social
  trust_political ~~ 1*trust_political

  hope_political ~~ trust_social + trust_political
  trust_social ~~ trust_political

# 4. intercepts
  
  psppsgva + actrolga + psppipla + cptppola ~ 1
  ppltrst + pplfair + pplhlp ~ 1
  trstprl + trstlgl + trstplc + trstplt + trstprt ~ 1

"

o1 <- l_o(m1, d)

```


The initial model had three latent variables, viz., `SocTrst`, `PolTrst`, and `PolHope` and the covariances were also included in the model. The model fit is shown in Figure X. However, the model did not fit well: $\chi^2 =$ `r o1$ch`, $p =$ `r o1$p`, $df =$ `r o1$df`, and most importantly, $RMSEA =$ `r o1$rmsea`, $CFI =$ `r o1$cfi`, $SRMR =$ `r o1$srmr`, and $TLI =$ `r o1$tli`.


```{r fig1, results="asis", echo=FALSE, fig.cap="Model 1", fig.scap="Model 1"}

p(o1$f)

```

## Model 2

```{r}
m2 <- "

# 1. latent variable definitions

  hope_political =~ NA*psppsgva + actrolga + psppipla + cptppola
  trust_social =~ NA*ppltrst + pplfair + pplhlp
  trust_political =~ NA*trstprl + trstlgl + trstplc + trstplt + trstprt
  optimism_political =~ NA*psppsgva + actrolga + psppipla + cptppola +
                        trstprl + trstlgl + trstplc + trstplt + trstprt

# 2. regressions

  hope_political + trust_social + trust_political + optimism_political ~ dscrscore + polintr

# 3. (co)variances

  hope_political ~~ 1*hope_political
  trust_social ~~ 1*trust_social
  trust_political ~~ 1*trust_political
  optimism_political ~~ 1*optimism_political
  
  hope_political ~~ trust_social + trust_political
  trust_social ~~ trust_political

# 4. intercepts
  
  psppsgva + actrolga + psppipla + cptppola ~ 1
  ppltrst + pplfair + pplhlp ~ 1
  trstprl + trstlgl + trstplc + trstplt + trstprt ~ 1

"

o2 <- l_o(m2, d)

```


The modification indices of Model 1 suggested that all the items of political trust and political be allowed to covary. This (together sith poor fit of Model 1) was an indication that those items can load on another factor. Hence, a forth factor was added to explain the remaining covariance of these items. Based on the loadings, it was called *Political Optimism* (coded as `PolOptm), that models a general the positive attitude towards politics.

This model, shown in Figure 2, had a decent fit ($\chi^2 =$ `r o2$ch`, df = `r o2$df`, RMSEA = `r o2$rmsea`, CFI = `r o2$cfi`, SRMR = `r o2$srmr`, and TLI = `r o2$tli`.)


```{r fig2, results="asis", echo=FALSE, fig.cap="Model 2", fig.scap="Model 2"}

p(o2$f)

```


```{r tbl1, results="asis", echo=FALSE, include=TRUE}

kable(rbind(o1$l, o1$r, o1$thr),
      "latex",
      caption = "Estimated parameters of model 1",
      label = "l",
      booktabs = T,
      digits = 2) %>% 
  kable_styling(latex_options="scale_down")
```


```{r tbl2, results="asis", echo=FALSE, include=TRUE}

kable(rbind(o2$l, o2$r, o2$thr),
      "latex",
      caption = "Estimated parameters of model 2",
      label = "l",
      booktabs = T,
      digits = 2) %>% 
  kable_styling(latex_options="scale_down")
```


```{r tbl111, results="asis", echo=FALSE, include=TRUE}

kable(o1$s %>% filter(est != 0),
      "latex",
      caption = "Loadings o model 1",
      label = "l",
      booktabs = T,
      digits = 2) %>% 
  kable_styling(latex_options="scale_down")
```

# References

`r p(o1$f)`